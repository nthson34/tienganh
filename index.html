<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học Tiếng Anh Thật Vui!</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* Custom styles if needed, but Tailwind is preferred */
      body {
        font-family: 'Inter', sans-serif;
      }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-200 to-purple-300 min-h-screen flex flex-col items-center justify-center p-4">
    <div id="root"></div>

    <script type="text/babel">
        // Main App component for the interactive English learning website
        function App() {
          const { useState, useEffect } = React;

          const vocabulary = [
            // Animals (10 words)
            { english: 'Cat', vietnamese: 'Mèo' },
            { english: 'Dog', vietnamese: 'Chó' },
            { english: 'Bird', vietnamese: 'Chim' },
            { english: 'Fish', vietnamese: 'Cá' },
            { english: 'Lion', vietnamese: 'Sư tử' },
            { english: 'Elephant', vietnamese: 'Voi' },
            { english: 'Monkey', vietnamese: 'Khỉ' },
            { english: 'Bear', vietnamese: 'Gấu' },
            { english: 'Rabbit', vietnamese: 'Thỏ' },
            { english: 'Tiger', vietnamese: 'Hổ' },
            // Fruits (10 words)
            { english: 'Apple', vietnamese: 'Quả táo' },
            { english: 'Banana', vietnamese: 'Quả chuối' },
            { english: 'Orange', vietnamese: 'Quả cam' },
            { english: 'Grape', vietnamese: 'Quả nho' },
            { english: 'Strawberry', vietnamese: 'Dâu tây' },
            { english: 'Mango', vietnamese: 'Xoài' },
            { english: 'Pineapple', vietnamese: 'Dứa' },
            { english: 'Watermelon', vietnamese: 'Dưa hấu' },
            { english: 'Cherry', vietnamese: 'Anh đào' },
            { english: 'Kiwi', vietnamese: 'Kiwi' },
            // Vegetables (10 words)
            { english: 'Carrot', vietnamese: 'Cà rốt' },
            { english: 'Tomato', vietnamese: 'Cà chua' },
            { english: 'Potato', vietnamese: 'Khoai tây' },
            { english: 'Broccoli', vietnamese: 'Bông cải xanh' },
            { english: 'Onion', vietnamese: 'Hành tây' },
            { english: 'Cucumber', vietnamese: 'Dưa chuột' },
            { english: 'Pepper', vietnamese: 'Ớt chuông' },
            { english: 'Cabbage', vietnamese: 'Bắp cải' },
            { english: 'Corn', vietnamese: 'Ngô' },
            { english: 'Lettuce', vietnamese: 'Xà lách' },
            // Family (10 words)
            { english: 'Mother', vietnamese: 'Mẹ' },
            { english: 'Father', vietnamese: 'Bố' },
            { english: 'Brother', vietnamese: 'Anh/Em trai' },
            { english: 'Sister', vietnamese: 'Chị/Em gái' },
            { english: 'Grandmother', vietnamese: 'Bà' },
            { english: 'Grandfather', vietnamese: 'Ông' },
            { english: 'Baby', vietnamese: 'Em bé' },
            { english: 'Family', vietnamese: 'Gia đình' },
            { english: 'Aunt', vietnamese: 'Cô/Dì' },
            { english: 'Uncle', vietnamese: 'Chú/Cậu' },
            // Body Parts (10 words)
            { english: 'Head', vietnamese: 'Đầu' },
            { english: 'Hand', vietnamese: 'Bàn tay' },
            { english: 'Foot', vietnamese: 'Bàn chân' },
            { english: 'Eye', vietnamese: 'Mắt' },
            { english: 'Ear', vietnamese: 'Tai' },
            { english: 'Nose', vietnamese: 'Mũi' },
            { english: 'Mouth', vietnamese: 'Miệng' },
            { english: 'Arm', vietnamese: 'Cánh tay' },
            { english: 'Leg', vietnamese: 'Chân' },
            { english: 'Hair', vietnamese: 'Tóc' },
            // Clothes (10 words)
            { english: 'Shirt', vietnamese: 'Áo sơ mi' },
            { english: 'Pants', vietnamese: 'Quần dài' },
            { english: 'Dress', vietnamese: 'Váy' },
            { english: 'Shoes', vietnamese: 'Giày' },
            { english: 'Hat', vietnamese: 'Mũ' },
            { english: 'Socks', vietnamese: 'Tất' },
            { english: 'Coat', vietnamese: 'Áo khoác' },
            { english: 'Skirt', vietnamese: 'Chân váy' },
            { english: 'T-shirt', vietnamese: 'Áo phông' },
            { english: 'Jacket', vietnamese: 'Áo jacket' },
            // School Objects (10 words)
            { english: 'Book', vietnamese: 'Sách' },
            { english: 'Pen', vietnamese: 'Bút mực' },
            { english: 'Pencil', vietnamese: 'Bút chì' },
            { english: 'Eraser', vietnamese: 'Tẩy' },
            { english: 'Ruler', vietnamese: 'Thước kẻ' },
            { english: 'Bag', vietnamese: 'Cặp sách' },
            { english: 'Desk', vietnamese: 'Bàn học' },
            { english: 'Chair', vietnamese: 'Ghế' },
            { english: 'Notebook', vietnamese: 'Vở' },
            { english: 'Scissors', vietnamese: 'Kéo' },
            // Professions (10 words)
            { english: 'Teacher', vietnamese: 'Giáo viên' },
            { english: 'Doctor', vietnamese: 'Bác sĩ' },
            { english: 'Police Officer', vietnamese: 'Cảnh sát' },
            { english: 'Firefighter', vietnamese: 'Lính cứu hỏa' },
            { english: 'Chef', vietnamese: 'Đầu bếp' },
            { english: 'Pilot', vietnamese: 'Phi công' },
            { english: 'Artist', vietnamese: 'Họa sĩ' },
            { english: 'Engineer', vietnamese: 'Kỹ sư' },
            { english: 'Farmer', vietnamese: 'Nông dân' },
            { english: 'Student', vietnamese: 'Học sinh' },
            // Vehicles (10 words)
            { english: 'Car', vietnamese: 'Ô tô' },
            { english: 'Bicycle', vietnamese: 'Xe đạp' },
            { english: 'Motorcycle', vietnamese: 'Xe máy' },
            { english: 'Bus', vietnamese: 'Xe buýt' },
            { english: 'Train', vietnamese: 'Tàu hỏa' },
            { english: 'Airplane', vietnamese: 'Máy bay' },
            { english: 'Boat', vietnamese: 'Thuyền' },
            { english: 'Truck', vietnamese: 'Xe tải' },
            { english: 'Helicopter', vietnamese: 'Máy bay trực thăng' },
            { english: 'Tractor', vietnamese: 'Máy kéo' },
            // Actions/Verbs (10 words)
            { english: 'Run', vietnamese: 'Chạy' },
            { english: 'Jump', vietnamese: 'Nhảy' },
            { english: 'Eat', vietnamese: 'Ăn' },
            { english: 'Drink', vietnamese: 'Uống' },
            { english: 'Sleep', vietnamese: 'Ngủ' },
            { english: 'Read', vietnamese: 'Đọc' },
            { english: 'Write', vietnamese: 'Viết' },
            { english: 'Sing', vietnamese: 'Hát' },
            { english: 'Dance', vietnamese: 'Nhảy múa' },
            { english: 'Play', vietnamese: 'Chơi' },
            // Colors (10 words) - These words will be illustrated by their actual color on the box background.
            { english: 'Red', vietnamese: 'Màu đỏ' },
            { english: 'Blue', vietnamese: 'Màu xanh dương' },
            { english: 'Green', vietnamese: 'Màu xanh lá' },
            { english: 'Yellow', vietnamese: 'Màu vàng' },
            { english: 'Orange', vietnamese: 'Màu cam' },
            { english: 'Purple', vietnamese: 'Màu tím' },
            { english: 'Pink', vietnamese: 'Màu hồng' },
            { english: 'Black', vietnamese: 'Màu đen' },
            { english: 'White', vietnamese: 'Màu trắng' },
            { english: 'Brown', vietnamese: 'Màu nâu' },
          ];

          const colorMap = {
            Red: '#FF0000', Blue: '#0000FF', Green: '#00FF00', Yellow: '#FFFF00', Orange: '#FFA500',
            Purple: '#800080', Pink: '#FFC0CB', Black: '#000000', White: '#FFFFFF', Brown: '#A52A2A'
          };
          const colorWords = Object.keys(colorMap);

          const [shuffledVocabulary, setShuffledVocabulary] = useState([]);
          const [currentShuffledIndex, setCurrentShuffledIndex] = useState(0);
          const [utterance, setUtterance] = useState(null);
          const [isSpeechReady, setIsSpeechReady] = useState(false);
          const [gameMode, setGameMode] = useState('flashcard');
          const [quizOptions, setQuizOptions] = useState([]);
          const [selectedAnswer, setSelectedAnswer] = useState(null);
          const [score, setScore] = useState(0);
          const [totalQuestions, setTotalQuestions] = useState(0);
          const [fillInBlanksInput, setFillInBlanksInput] = useState('');
          const [blankedWord, setBlankedWord] = useState('');
          const [fillInBlanksCorrect, setFillInBlanksCorrect] = useState(null);

          const currentWord = shuffledVocabulary[currentShuffledIndex];

          const shuffleAndSetNewWord = () => {
            const tempVocab = [...vocabulary];
            for (let i = tempVocab.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [tempVocab[i], tempVocab[j]] = [tempVocab[j], tempVocab[i]];
            }
            setShuffledVocabulary(tempVocab);
            setCurrentShuffledIndex(0);
            return tempVocab[0]; // Return the first word of the newly shuffled list
          };

          useEffect(() => {
            if ('speechSynthesis' in window) {
              const synthUtterance = new SpeechSynthesisUtterance();
              synthUtterance.lang = 'en-US';
              synthUtterance.rate = 0.8;
              setUtterance(synthUtterance);

              const loadVoices = () => {
                const voices = window.speechSynthesis.getVoices();
                const englishUSVoice = voices.find(
                  voice => voice.lang === 'en-US' && (voice.name.includes('Google') || voice.name.includes('Samantha') || voice.name.includes('Alex'))
                ) || voices.find(voice => voice.lang === 'en-US');

                if (englishUSVoice) {
                  synthUtterance.voice = englishUSVoice;
                  console.log('Using voice:', englishUSVoice.name);
                }
                setIsSpeechReady(true);
              };

              if (window.speechSynthesis.getVoices().length > 0) {
                loadVoices();
              } else {
                window.speechSynthesis.onvoiceschanged = loadVoices;
              }

            } else {
              console.warn('Trình duyệt này không hỗ trợ chức năng phát âm.');
            }
            // Initial shuffle and setup for Flashcard mode on component mount
            const initialWord = shuffleAndSetNewWord();
            // No need to generate options/blanks here, as default mode is Flashcard.
            // When user switches mode, `changeGameMode` will handle setup.
          }, []);

          const generateMissingLettersWord = (word) => {
            if (word.length <= 2) return word;
            const letters = word.split('');
            const numToBlank = Math.max(1, Math.floor(letters.length / 3));

            let blankedIndices = new Set();
            const availableIndices = Array.from({ length: letters.length - 2 }, (_, i) => i + 1);

            while (blankedIndices.size < numToBlank && availableIndices.length > 0) {
                const randomIndex = Math.floor(Math.random() * availableIndices.length);
                const indexToBlank = availableIndices.splice(randomIndex, 1)[0];
                blankedIndices.add(indexToBlank);
            }

            return letters.map((char, index) =>
                blankedIndices.has(index) ? '_' : char
            ).join('');
          };


          // Function to generate multiple-choice options for quizzes, now takes wordObject as arg
          const generateGameOptionsForWord = (wordObject) => {
            if (!wordObject) {
                console.error("generateGameOptionsForWord called without a valid wordObject!");
                return;
            }
            const correctWord = wordObject.english;
            const allEnglishWords = [...new Set(vocabulary.map(word => word.english))];
            let options = [correctWord];

            const potentialDistractors = allEnglishWords.filter(word => word.toLowerCase() !== correctWord.toLowerCase());

            while (options.length < 3 && potentialDistractors.length > 0) {
              const randomIndex = Math.floor(Math.random() * (potentialDistractors.length));
              options.push(potentialDistractors.splice(randomIndex, 1)[0]);
            }
            setQuizOptions(options.sort(() => Math.random() - 0.5));
          };


          // Unified effect for handling word changes within game modes (next/prev button clicks)
          useEffect(() => {
            console.log('Main game logic useEffect triggered. Mode:', gameMode, 'Word:', currentWord ? currentWord.english : 'N/A');

            if (!currentWord) {
                console.log("currentWord not ready in useEffect, returning early.");
                return;
            }

            if (gameMode === 'visual_quiz' || gameMode === 'audio_quiz') {
                console.log('Generating quiz options for:', currentWord.english);
                generateGameOptionsForWord(currentWord);
            } else if (gameMode === 'fill_in_blanks') {
                console.log('Generating blanked word for:', currentWord.english);
                setBlankedWord(generateMissingLettersWord(currentWord.english));
            }
            // Reset states for new question within a game mode
            setSelectedAnswer(null);
            setFillInBlanksInput('');
            setFillInBlanksCorrect(null);
          }, [currentShuffledIndex, gameMode, currentWord]); // Dependencies: Only trigger when index, mode, or word itself changes


          const speakWord = () => {
            if (utterance && isSpeechReady && currentWord) {
              window.speechSynthesis.cancel();
              utterance.text = currentWord.english;
              window.speechSynthesis.speak(utterance);
            } else {
              console.warn('Chức năng phát âm chưa sẵn sàng hoặc không được hỗ trợ.');
            }
          };

          const nextWord = () => {
            setCurrentShuffledIndex((prevIndex) => {
              const nextIdx = (prevIndex + 1);
              if (nextIdx >= shuffledVocabulary.length) {
                shuffleAndSetNewWord(); // This will reset index to 0 internally
                return 0; // Ensures currentShuffledIndex state is consistent with the reset
              }
              return nextIdx;
            });
          };

          const prevWord = () => {
            setCurrentShuffledIndex((prevIndex) => (prevIndex - 1 + shuffledVocabulary.length) % shuffledVocabulary.length);
          };

          const handleAnswerClick = (answer) => {
            if (selectedAnswer !== null) return;

            setSelectedAnswer(answer);
            if (answer.toLowerCase() === currentWord.english.toLowerCase()) {
              setScore(prevScore => prevScore + 1);
            }
            setTotalQuestions(prevTotal => prevTotal + 1);
          };

          const handleFillInBlanksInput = (event) => {
            setFillInBlanksInput(event.target.value);
          };

          const handleFillInBlanksSubmit = () => {
            if (fillInBlanksCorrect !== null) return;

            if (fillInBlanksInput.toLowerCase() === currentWord.english.toLowerCase()) {
              setFillInBlanksCorrect(true);
              setScore(prevScore => prevScore + 1);
            } else {
              setFillInBlanksCorrect(false);
            }
            setTotalQuestions(prevTotal => prevTotal + 1);
          };

          const resetGame = () => {
            setScore(0);
            setTotalQuestions(0);
            const newWord = shuffleAndSetNewWord(); // Get the first word of the new shuffled list
            
            // Explicitly set up game for the new first word
            if (newWord) {
                if (gameMode === 'visual_quiz' || gameMode === 'audio_quiz') {
                    generateGameOptionsForWord(newWord);
                } else if (gameMode === 'fill_in_blanks') {
                    setBlankedWord(generateMissingLettersWord(newWord.english));
                }
            }
            setSelectedAnswer(null);
            setFillInBlanksInput('');
            setFillInBlanksCorrect(null);
          };

          const nextGameQuestion = () => {
            nextWord(); // This will trigger the main useEffect for next word
            // States are reset within the main useEffect due to currentWord change
          };

          const changeGameMode = (mode) => {
            console.log("Changing game mode to:", mode);
            setGameMode(mode);
            setScore(0);
            setTotalQuestions(0);
            setSelectedAnswer(null);
            setFillInBlanksInput('');
            setBlankedWord('');
            setFillInBlanksCorrect(null);

            // Always reshuffle and get the first word of the new set
            const newCurrentWord = shuffleAndSetNewWord(); // Returns the first word object

            // Based on the new mode and the explicitly obtained newCurrentWord,
            // immediately set up the game state.
            if (newCurrentWord) {
                if (mode === 'visual_quiz' || mode === 'audio_quiz') {
                    console.log('Setting up quiz options for mode:', mode, 'and word:', newCurrentWord.english);
                    generateGameOptionsForWord(newCurrentWord);
                } else if (mode === 'fill_in_blanks') {
                    console.log('Setting up fill-in-blanks for word:', newCurrentWord.english);
                    setBlankedWord(generateMissingLettersWord(newCurrentWord.english));
                }
            } else {
                console.error("Failed to get a new current word after shuffling in changeGameMode for mode:", mode);
            }
            // No need to call generateGameOptions/setBlankedWord again in useEffect
            // if it's already set here for the initial mode switch.
          };

          const progressPercentage = (shuffledVocabulary.length > 0)
            ? ((currentShuffledIndex + 1) / shuffledVocabulary.length) * 100
            : 0;

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-200 to-purple-300 flex flex-col items-center justify-center p-4 md:p-8 lg:p-12 font-inter">
              {/* Page Title */}
              <h1 className="text-4xl md:text-5xl lg:text-6xl font-extrabold text-blue-800 mb-6 md:mb-8 drop-shadow-lg text-center leading-tight">
                Học Tiếng Anh Thật Vui!
              </h1>

              {/* Mode Toggle Buttons */}
              <div className="flex flex-col sm:flex-row flex-wrap justify-center gap-3 md:gap-4 mb-6 md:mb-8 w-full max-w-sm sm:max-w-md lg:max-w-lg">
                <button
                  onClick={() => changeGameMode('flashcard')}
                  className={`flex-1 px-4 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-lg sm:text-xl shadow-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4
                    ${gameMode === 'flashcard' ? 'bg-indigo-600 text-white ring-indigo-300' : 'bg-indigo-400 text-white hover:bg-indigo-500 ring-transparent'}`}
                >
                  Thẻ Từ
                </button>
                <button
                  onClick={() => changeGameMode('visual_quiz')}
                  className={`flex-1 px-4 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-lg sm:text-xl shadow-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4
                    ${gameMode === 'visual_quiz' ? 'bg-purple-600 text-white ring-purple-300' : 'bg-purple-500 text-white hover:bg-purple-600 ring-transparent'}`}
                >
                  Trò chơi Hình ảnh & Từ
                </button>
                <button
                  onClick={() => changeGameMode('audio_quiz')}
                  className={`flex-1 px-4 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-lg sm:text-xl shadow-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4
                    ${gameMode === 'audio_quiz' ? 'bg-teal-600 text-white ring-teal-300' : 'bg-teal-500 text-white hover:bg-teal-600 ring-transparent'}`}
                >
                  Trò chơi Nghe & Chọn
                </button>
                <button
                  onClick={() => changeGameMode('fill_in_blanks')}
                  className={`flex-1 px-4 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-lg sm:text-xl shadow-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4
                    ${gameMode === 'fill_in_blanks' ? 'bg-red-600 text-white ring-red-300' : 'bg-red-500 text-white hover:bg-red-600 ring-transparent'}`}
                >
                  Viết Từ Còn Thiếu
                </button>
              </div>

              {/* Progress Bar */}
              {(shuffledVocabulary.length > 0) && ( // Only show if vocabulary is loaded
                <div className="w-full max-w-xs sm:max-w-sm md:max-w-md lg:max-w-lg bg-gray-200 rounded-full h-3 mb-6 overflow-hidden shadow-inner">
                  <div
                    className="bg-green-500 h-full rounded-full transition-all duration-500 ease-out"
                    style={{ width: `${progressPercentage}%` }}
                  ></div>
                </div>
              )}

              {currentWord ? ( // Ensure currentWord is loaded before rendering UI
                <>
                  {gameMode === 'visual_quiz' ? (
                    // Visual Quiz Mode UI
                    <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-8 lg:p-10 w-full max-w-sm md:max-w-md lg:max-w-lg flex flex-col items-center transform transition-transform duration-300 hover:scale-105">
                      <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-700 mb-6 text-center">
                        Từ nào có nghĩa là "{currentWord.vietnamese}"?
                      </h2>

                      <div className="grid grid-cols-1 gap-3 md:gap-4 w-full mb-6">
                        {quizOptions.map((option, idx) => (
                          <button
                            key={idx}
                            onClick={() => handleAnswerClick(option)}
                            disabled={selectedAnswer !== null}
                            className={`py-3 px-5 rounded-full font-semibold text-base sm:text-xl shadow-md transition-all duration-200
                              ${selectedAnswer === null
                                ? 'bg-blue-500 hover:bg-blue-600 text-white'
                                : option.toLowerCase() === currentWord.english.toLowerCase() && option.toLowerCase() === selectedAnswer.toLowerCase()
                                  ? 'bg-green-500 text-white'
                                  : option.toLowerCase() !== currentWord.english.toLowerCase() && option.toLowerCase() === selectedAnswer.toLowerCase()
                                    ? 'bg-red-500 text-white'
                                    : option.toLowerCase() === currentWord.english.toLowerCase() && selectedAnswer !== null
                                      ? 'bg-green-300 text-gray-800'
                                      : 'bg-gray-300 text-gray-600 cursor-not-allowed'
                              }
                              ${selectedAnswer && 'opacity-75'}
                            `}
                          >
                            {option}
                          </button>
                        ))}
                      </div>

                      {selectedAnswer && (
                        <div className="mt-4 text-center flex flex-col items-center">
                          {selectedAnswer.toLowerCase() === currentWord.english.toLowerCase() ? (
                            <p className="text-xl md:text-2xl font-bold mb-4 text-green-700">Chính xác! 🎉</p>
                          ) : (
                            <p className="text-xl md:text-2xl font-bold mb-4 text-red-700">
                                Sai rồi! Đáp án đúng là: **{currentWord.english}** 😅
                            </p>
                          )}
                          <div className="flex flex-col sm:flex-row gap-3 md:gap-4">
                            <button
                              onClick={speakWord}
                              className="px-5 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-base sm:text-lg bg-indigo-500 text-white shadow-lg hover:bg-indigo-600 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-300"
                            >
                              Nghe lại từ đúng
                            </button>
                            <button
                              onClick={nextGameQuestion}
                              className="px-5 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-base sm:text-lg bg-blue-500 text-white shadow-lg hover:bg-blue-600 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-300"
                            >
                              Câu hỏi tiếp theo
                            </button>
                          </div>
                        </div>
                      )}

                      <p className="text-lg md:text-xl font-semibold text-gray-700 mt-6">
                        Điểm: {score} / {totalQuestions}
                      </p>
                      <button
                        onClick={resetGame}
                        className="mt-4 px-5 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-base sm:text-lg bg-gray-500 text-white shadow-lg hover:bg-gray-600 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300"
                      >
                        Chơi lại Hình ảnh & Từ
                      </button>
                    </div>
                  ) : gameMode === 'audio_quiz' ? (
                    // Audio Quiz Mode UI (Listen & Choose)
                    <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-8 lg:p-10 w-full max-w-sm md:max-w-md lg:max-w-lg flex flex-col items-center transform transition-transform duration-300 hover:scale-105">
                      <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-700 mb-6 text-center">
                        Bạn nghe từ nào?
                      </h2>
                      <button
                        onClick={speakWord}
                        disabled={!isSpeechReady}
                        className="flex items-center px-6 py-3 sm:px-8 sm:py-4 bg-green-500 hover:bg-green-600 text-white font-semibold text-lg sm:text-xl rounded-full shadow-lg transform transition-all duration-200 hover:scale-105 hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-green-300 disabled:opacity-50 disabled:cursor-not-allowed mb-6"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          className="h-6 w-6 sm:h-7 sm:w-7 mr-2 sm:mr-3"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                          strokeWidth="2"
                        >
                          <path
                            strokeLinecap="round"
                            strokeLinejoin="round"
                            d="M17.293 13.293A8 8 0 0120 10a8 8 0 01-2.707-6.707A8 8 0 0012 4c-3.111 0-5.69 1.769-6.494 4.195l-.161.493a8 8 0 00-2.455 3.313A8 8 0 0012 16c3.111 0 5.69-1.769 6.494-4.195l.161-.493a8 8 0 002.455-3.313z"
                          />
                          <path strokeLinecap="round" strokeLinejoin="round" d="M9 13H7V9h2a2 2 0 012 2v2a2 2 0 01-2 2z" />
                        </svg>
                        Nghe từ
                      </button>

                      <div className="grid grid-cols-1 gap-3 md:gap-4 w-full mb-6">
                        {quizOptions.map((option, idx) => (
                          <button
                            key={idx}
                            onClick={() => handleAnswerClick(option)}
                            disabled={selectedAnswer !== null}
                            className={`py-3 px-5 rounded-full font-semibold text-base sm:text-xl shadow-md transition-all duration-200
                              ${selectedAnswer === null
                                ? 'bg-blue-500 hover:bg-blue-600 text-white'
                                : option.toLowerCase() === currentWord.english.toLowerCase() && option.toLowerCase() === selectedAnswer.toLowerCase()
                                  ? 'bg-green-500 text-white'
                                  : option.toLowerCase() !== currentWord.english.toLowerCase() && option.toLowerCase() === selectedAnswer.toLowerCase()
                                    ? 'bg-red-500 text-white'
                                    : option.toLowerCase() === currentWord.english.toLowerCase() && selectedAnswer !== null
                                      ? 'bg-green-300 text-gray-800'
                                      : 'bg-gray-300 text-gray-600 cursor-not-allowed'
                              }
                              ${selectedAnswer && 'opacity-75'}
                            `}
                          >
                            {option}
                          </button>
                        ))}
                      </div>

                      {selectedAnswer && (
                        <div className="mt-4 text-center flex flex-col items-center">
                          {selectedAnswer.toLowerCase() === currentWord.english.toLowerCase() ? (
                            <p className="text-xl md:text-2xl font-bold mb-4 text-green-700">Chính xác! 🎉</p>
                          ) : (
                            <p className="text-xl md:text-2xl font-bold mb-4 text-red-700">
                                Sai rồi! Đáp án đúng là: **{currentWord.english}** 😅
                            </p>
                          )}
                          <div className="flex flex-col sm:flex-row gap-3 md:gap-4">
                            <button
                              onClick={speakWord}
                              className="px-5 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-base sm:text-lg bg-indigo-500 text-white shadow-lg hover:bg-indigo-600 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-300"
                            >
                              Nghe lại từ đúng
                            </button>
                            <button
                              onClick={nextGameQuestion}
                              className="px-5 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-base sm:text-lg bg-blue-500 text-white shadow-lg hover:bg-blue-600 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-ring-blue-300"
                            >
                              Câu hỏi tiếp theo
                            </button>
                          </div>
                        </div>
                      )}

                      <p className="text-lg md:text-xl font-semibold text-gray-700 mt-6">
                        Điểm: {score} / {totalQuestions}
                      </p>
                      <button
                        onClick={resetGame}
                        className="mt-4 px-5 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-base sm:text-lg bg-gray-500 text-white shadow-lg hover:bg-gray-600 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300"
                      >
                        Chơi lại Nghe & Chọn
                      </button>
                    </div>
                  ) : gameMode === 'fill_in_blanks' ? (
                    // Fill in the Blanks Mode UI
                    <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-8 lg:p-10 w-full max-w-sm md:max-w-md lg:max-w-lg flex flex-col items-center transform transition-transform duration-300 hover:scale-105">
                      <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-700 mb-6 text-center">
                        Điền từ còn thiếu vào chỗ trống:
                      </h2>

                      <p className="text-xl md:text-2xl lg:text-3xl text-gray-600 mb-4 select-none italic text-center px-2">
                        "{currentWord.vietnamese}"
                      </p>

                      <p className="text-4xl sm:text-5xl lg:text-6xl font-bold text-gray-800 mb-6 tracking-wide text-center px-2">
                        {blankedWord}
                      </p>

                      <input
                        type="text"
                        value={fillInBlanksInput}
                        onChange={handleFillInBlanksInput}
                        disabled={fillInBlanksCorrect !== null}
                        className="w-full max-w-xs md:max-w-sm lg:max-w-md px-4 py-3 mb-6 border-2 border-blue-400 rounded-lg text-xl md:text-2xl text-center focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed"
                        placeholder="Nhập từ tiếng Anh..."
                      />

                      <button
                        onClick={handleFillInBlanksSubmit}
                        disabled={fillInBlanksCorrect !== null || fillInBlanksInput.trim() === ''}
                        className={`px-8 py-4 rounded-full font-semibold text-xl shadow-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 mb-6
                          ${fillInBlanksCorrect === null
                            ? 'bg-orange-500 hover:bg-orange-600 text-white ring-orange-300'
                            : 'bg-gray-300 text-gray-600 cursor-not-allowed ring-transparent'
                          }`}
                      >
                        Kiểm tra
                      </button>

                      {fillInBlanksCorrect !== null && (
                        <div className="mt-4 text-center flex flex-col items-center">
                          {fillInBlanksCorrect ? (
                            <p className="text-xl md:text-2xl font-bold mb-4 text-green-700">Chính xác! 🎉</p>
                          ) : (
                            <p className="text-xl md:text-2xl font-bold mb-4 text-red-700">
                                Sai rồi! Đáp án đúng là: **{currentWord.english}** 😅
                            </p>
                          )}
                          <div className="flex flex-col sm:flex-row gap-3 md:gap-4">
                            <button
                              onClick={speakWord}
                              className="px-5 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-base sm:text-lg bg-indigo-500 text-white shadow-lg hover:bg-indigo-600 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-300"
                            >
                              Nghe lại từ đúng
                            </button>
                            <button
                              onClick={nextGameQuestion}
                              className="px-5 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-base sm:text-lg bg-blue-500 text-white shadow-lg hover:bg-blue-600 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-ring-blue-300"
                            >
                              Câu hỏi tiếp theo
                            </button>
                          </div>
                        </div>
                      )}

                      <p className="text-lg md:text-xl font-semibold text-gray-700 mt-6">
                        Điểm: {score} / {totalQuestions}
                      </p>
                      <button
                        onClick={resetGame}
                        className="mt-4 px-5 py-2 sm:px-6 sm:py-3 rounded-full font-semibold text-base sm:text-lg bg-gray-500 text-white shadow-lg hover:bg-gray-600 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300"
                      >
                        Chơi lại Viết Từ Còn Thiếu
                      </button>
                    </div>
                  ) : (
                    // Flashcard Mode UI
                    <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-8 lg:p-10 w-full max-w-sm md:max-w-md lg:max-w-lg flex flex-col items-center transform transition-transform duration-300 hover:scale-105">
                      {(() => {
                        const isColorWord = colorWords.includes(currentWord.english);
                        const textColor = (currentWord.english === 'Black' || currentWord.english === 'Purple' || currentWord.english === 'Brown') ? 'white' : 'black';
                        return (
                          <div
                            className={`flex items-center justify-center w-full max-w-[200px] sm:max-w-[250px] md:max-w-[300px] aspect-square rounded-xl mb-6 border-4 shadow-md
                              ${isColorWord ? 'border-transparent' : 'border-purple-400'}
                            `}
                            style={isColorWord ? { backgroundColor: colorMap[currentWord.english], color: textColor } : {}}
                          >
                            <span className={`font-bold text-center px-2 select-none ${isColorWord ? 'text-2xl sm:text-3xl md:text-4xl uppercase' : 'text-4xl sm:text-5xl md:text-6xl text-gray-700'}`}>
                              {currentWord.english}
                            </span>
                          </div>
                        );
                      })()}

                      <p className="text-4xl sm:text-5xl lg:text-7xl font-bold text-gray-800 mb-2 select-none tracking-wide text-center px-2">
                        {currentWord.english}
                      </p>

                      <p className="text-xl sm:text-2xl lg:text-4xl text-gray-600 mb-6 select-none italic text-center px-2">
                        {currentWord.vietnamese}
                      </p>

                      <div className="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 md:space-x-6 w-full justify-center">
                        <button
                          onClick={prevWord}
                          className="flex items-center justify-center px-5 py-2 sm:px-6 sm:py-3 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold text-base sm:text-lg rounded-full shadow-lg transform transition-all duration-200 hover:scale-105 hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-yellow-300 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            className="h-5 w-5 sm:h-6 sm:w-6 mr-2"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            strokeWidth="2"
                          >
                            <path strokeLinecap="round" strokeLinejoin="round" d="M15 19l-7-7 7-7" />
                          </svg>
                          Trước
                        </button>

                        <button
                          onClick={speakWord}
                          disabled={!isSpeechReady}
                          className="flex items-center justify-center px-5 py-2 sm:px-6 sm:py-3 bg-green-500 hover:bg-green-600 text-white font-semibold text-base sm:text-lg rounded-full shadow-lg transform transition-all duration-200 hover:scale-105 hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-green-300 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            className="h-5 w-5 sm:h-6 sm:w-6 mr-2"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            strokeWidth="2"
                          >
                            <path
                              strokeLinecap="round"
                              strokeLinejoin="round"
                              d="M17.293 13.293A8 8 0 0120 10a8 8 0 01-2.707-6.707A8 8 0 0012 4c-3.111 0-5.69 1.769-6.494 4.195l-.161.493a8 8 0 00-2.455 3.313A8 8 0 0012 16c3.111 0 5.69-1.769 6.494-4.195l.161-.493a8 8 0 002.455-3.313z"
                            />
                            <path strokeLinecap="round" strokeLinejoin="round" d="M9 13H7V9h2a2 2 0 012 2v2a2 2 0 01-2 2z" />
                          </svg>
                          Nghe
                        </button>

                        <button
                          onClick={nextWord}
                          className="flex items-center justify-center px-5 py-2 sm:px-6 sm:py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold text-base sm:text-lg rounded-full shadow-lg transform transition-all duration-200 hover:scale-105 hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-blue-300"
                        >
                          Tiếp theo
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            className="h-5 w-5 sm:h-6 sm:w-6 ml-2"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            strokeWidth="2"
                          >
                            <path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7" />
                          </svg>
                        </button>
                      </div>
                    </div>
                  )}
                </>
              ) : (
                <div className="text-xl text-gray-700">Đang tải từ vựng...</div>
              )}

              <p className="text-gray-600 text-xs sm:text-sm mt-8 opacity-75">
                &copy; 2025 Trang Web Học Tiếng Anh. Dành cho các bé.
              </p>
            </div>
          );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
