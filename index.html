<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>English Speaking for Kids</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&display=swap" rel="stylesheet">
<style>
:root{ --primary:#FF6B6B; --secondary:#4ECDC4; --bg:#F7FFF7; }
body{ margin:0; padding:16px; font-family:'Nunito', sans-serif; background:var(--bg); }
.container{ max-width:500px; margin:auto; background:#fff; border-radius:28px; padding:22px; border:4px solid var(--secondary); box-shadow:0 12px 30px rgba(0,0,0,.1); }
h1{ text-align:center; color:var(--primary); margin-bottom:10px; }
select{ width:100%; padding:12px; border-radius:14px; font-size:18px; margin-bottom:15px; border:2px solid #eee; }
.speed-box{ margin-bottom:15px; padding:12px; border-radius:16px; background:#F1FDFB; border:2px dashed var(--secondary); }
input[type=range]{ width:100%; }
.card{ padding:20px; border-radius:22px; border:2px solid #eee; min-height:150px; text-align:center; margin-bottom:15px; }
.question{ font-size:24px; font-weight:800; margin-bottom:10px; }
.answer{ font-size:22px; color:#2E7D32; font-weight:700; display:none; padding-top:10px; border-top:1px dashed #ccc; }
.buttons{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
.btn{ border:none; padding:15px; border-radius:15px; font-size:16px; font-weight:800; cursor:pointer; }
.listen{ background:#FFD93D; }
.listenAnswer{ background:#4FC3F7; color:#fff; }
.show{ background:#6BCB77; color:#fff; grid-column: span 2; }
.nav{ display:flex; gap:10px; margin-top:15px; }
.prev{ background:#B0BEC5; flex:1; }
.next{ background:var(--primary); color:#fff; flex:1; }
</style>
</head>
<body>

<div class="container">
    <h1>üéà English App</h1>
    <select id="unitSelect"></select>

    <div class="speed-box">
        <div style="font-weight:800; text-align:center">T·ªëc ƒë·ªô: <span id="speedVal">0.5</span></div>
        <input type="range" id="speed" min="0.3" max="0.8" step="0.1" value="0.5">
    </div>

    <div class="card">
        <div class="question" id="qText"></div>
        <div class="answer" id="aText"></div>
    </div>

    <div class="buttons">
        <button class="btn listen" onclick="handleSpeak('q')">üîä C√¢u h·ªèi</button>
        <button class="btn listenAnswer" onclick="handleSpeak('a')">üîä ƒê√°p √°n</button>
        <button class="btn show" onclick="toggle()">üëÄ Xem ƒë√°p √°n</button>
    </div>

    <div class="nav">
        <button class="btn prev" onclick="prev()">‚¨ÖÔ∏è</button>
        <button class="btn next" onclick="next()">‚û°Ô∏è</button>
    </div>
</div>

<script>
const data = [
    { name:"Unit 1: My Friend", q:[["How do you spell your name?","It‚Äôs V - I."], ["Where are you from?","I‚Äôm from Viet Nam."]] },
    { name:"Unit 2: Family", q:[["Who is this?","This is my mother."], ["What‚Äôs her name?","Her name is Chi."]] },
    { name:"Unit 3: School", q:[["Is this your book?","Yes, it is."], ["Do you like English?","Yes, I do."]] },
    { name:"Unit 4: Home", q:[["Where‚Äôs your dad?","He is in the bedroom."], ["How many rooms are there?","There are two rooms."]] }
];

let u=0, i=0;
const synth = window.speechSynthesis;

// 1. L√ÄM S·∫†CH VƒÇN B·∫¢N TR∆Ø·ªöC KHI ƒê·ªåC
function cleanAndSplit(text) {
    return text
        .replace(/[.,?!:;'"()\-]/g, " ") // Thay th·∫ø d·∫•u c√¢u b·∫±ng kho·∫£ng tr·∫Øng
        .split(/\s+/)                   // C·∫Øt theo m·ªôt ho·∫∑c nhi·ªÅu kho·∫£ng tr·∫Øng
        .filter(word => word.length > 0); // Lo·∫°i b·ªè c√°c ph·∫ßn t·ª≠ r·ªóng
}

function handleSpeak(type) {
    synth.cancel();
    const rawText = type === 'q' ? data[u].q[i][0] : data[u].q[i][1];
    const words = cleanAndSplit(rawText);
    let wordIdx = 0;

    function speakNext() {
        if (wordIdx < words.length) {
            const utter = new SpeechSynthesisUtterance(words[wordIdx]);
            utter.lang = 'en-US';
            utter.rate = document.getElementById("speed").value;
            utter.onend = () => {
                wordIdx++;
                setTimeout(speakNext, 250); // Ngh·ªâ 0.25s gi·ªØa c√°c t·ª´
            };
            synth.speak(utter);
        }
    }
    speakNext();
}

// Logic ƒëi·ªÅu khi·ªÉn App
const unitSelect = document.getElementById("unitSelect");
data.forEach((unit, idx) => { unitSelect.innerHTML += `<option value="${idx}">${unit.name}</option>`; });
unitSelect.onchange = () => { u=unitSelect.value; i=0; render(); };

document.getElementById("speed").oninput = (e) => { document.getElementById("speedVal").innerText = e.target.value; };

function render() {
    document.getElementById("qText").innerText = data[u].q[i][0];
    document.getElementById("aText").innerText = data[u].q[i][1];
    document.getElementById("aText").style.display = "none";
}

function toggle() { 
    const a = document.getElementById("aText");
    a.style.display = (a.style.display === "block") ? "none" : "block"; 
}

function next() { if(i < data[u].q.length-1) { i++; render(); } }
function prev() { if(i > 0) { i--; render(); } }

render();
</script>
</body>
</html>
