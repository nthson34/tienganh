<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>English Speaking for Kids</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&display=swap" rel="stylesheet">

<style>
:root{
  --primary: #FF6B6B;
  --secondary: #4ECDC4;
  --accent: #FFD93D;
  --bg: #F0F7F4;
}
body{
  margin: 0;
  padding: 15px;
  font-family: 'Nunito', sans-serif;
  background: var(--bg);
  color: #2D3436;
  user-select: none;
}
.container{
  max-width: 500px;
  margin: auto;
  background: #fff;
  border-radius: 32px;
  padding: 25px;
  border: 6px solid var(--secondary);
  box-shadow: 0 15px 40px rgba(0,0,0,0.08);
}
h1{
  text-align: center;
  color: var(--primary);
  font-size: 28px;
  margin: 0 0 15px 0;
}
select{
  width: 100%;
  padding: 14px;
  border-radius: 18px;
  font-size: 18px;
  border: 3px solid #E0E0E0;
  margin-bottom: 15px;
  font-family: inherit;
  font-weight: 700;
  cursor: pointer;
}
.speed-box{
  margin-bottom: 20px;
  padding: 12px;
  border-radius: 20px;
  background: #E8F9F7;
  border: 2px dashed var(--secondary);
}
.speed-label{ font-weight: 800; text-align: center; font-size: 16px; margin-bottom: 8px; }
input[type=range]{ width: 100%; cursor: pointer; accent-color: var(--secondary); }

.card{
  background: #FAFAFA;
  padding: 25px;
  border-radius: 25px;
  border: 2px solid #F0F0F0;
  min-height: 160px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  margin-bottom: 15px;
}
.question{
  font-size: 24px;
  font-weight: 800;
  color: #333;
  margin-bottom: 10px;
  line-height: 1.4;
}
.answer{
  font-size: 24px;
  font-weight: 700;
  color: #27AE60;
  padding-top: 15px;
  border-top: 2px dashed #DDD;
  width: 100%;
  display: none;
  animation: slideUp 0.3s ease;
}
@keyframes slideUp { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

.btn-group{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 10px;
}
.btn{
  border: none;
  padding: 16px;
  border-radius: 20px;
  font-size: 17px;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.1s;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 5px 0 rgba(0,0,0,0.1);
}
.btn:active{ transform: translateY(3px); box-shadow: none; }

.btn-q{ background: var(--accent); color: #5D4037; }
.btn-a{ background: #4FC3F7; color: white; }
.btn-show{ background: #6BCB77; color: white; grid-column: span 2; }

.nav{ display: flex; gap: 12px; margin-top: 20px; }
.btn-nav{ background: #B0BEC5; color: white; flex: 1; }
.btn-next{ background: var(--primary); color: white; flex: 1.5; }
</style>
</head>

<body>

<div class="container">
  <h1>üåü Kids English</h1>
  
  <select id="unitSelect"></select>

  <div class="speed-box">
    <div class="speed-label">üê¢ T·ªëc ƒë·ªô: <span id="speedVal">0.45</span></div>
    <input type="range" id="speed" min="0.3" max="0.7" step="0.05" value="0.45">
  </div>

  <div class="card">
    <div class="question" id="qText"></div>
    <div class="answer" id="aText"></div>
  </div>

  <div class="btn-group">
    <button class="btn btn-q" onclick="handleSpeak('q')">üîä C√¢u h·ªèi</button>
    <button class="btn btn-a" onclick="handleSpeak('a')">üîä ƒê√°p √°n</button>
    <button class="btn btn-show" onclick="toggle()">üëÄ Xem ƒë√°p √°n</button>
  </div>

  <div class="nav">
    <button class="btn btn-nav" onclick="prev()">‚¨ÖÔ∏è Tr∆∞·ªõc</button>
    <button class="btn btn-next" onclick="next()">Ti·∫øp ‚û°Ô∏è</button>
  </div>
</div>

<script>
// ==================
// D·ªÆ LI·ªÜU C√ÇU H·ªéI
// ==================
const data = [
  {
    name: "Unit 1: My Friend",
    q: [
      ["How do you spell your name?", "It‚Äôs V ‚Äì I."],
      ["Where are you from?", "I‚Äôm from Can Tho."],
      ["Do your friends like dancing?", "Yes, they do."]
    ]
  },
  {
    name: "Unit 2: Family",
    q: [
      ["Who is this?", "This is my mother."],
      ["What‚Äôs her name?", "Her name is Lan."],
      ["Do you have a pet?", "Yes, I do. I have a cat."]
    ]
  },
  {
    name: "Unit 3: School",
    q: [
      ["Is this your book?", "Yes, it is."],
      ["Are these your pens?", "Yes, they are."],
      ["Do you like English?", "Yes, I do."],
      ["When do you have English?", "I have English on Monday."]
    ]
  },
  {
    name: "Unit 4: Home",
    q: [
      ["Where‚Äôs your dad?", "He is in the living room."],
      ["What‚Äôs he doing?", "He is watching TV."],
      ["Who do you live with?", "I live with my mom and dad."],
      ["How many rooms are there?", "There are four rooms."]
    ]
  }
];

let u = 0, i = 0;
const synth = window.speechSynthesis;

// ==================
// X·ª¨ L√ù PH√ÅT √ÇM (FIX L·ªñI CH·ªÆ I)
// ==================
function cleanForSpeech(text) {
  return text
    .replace(/\bI\b/g, "eye")      // √âp m√°y ƒë·ªçc ch·ªØ "I" m·ªôt m√¨nh th√†nh "Ai" (eye)
    .replace(/[.,?!‚Äô'":;]/g, "")   // B·ªè d·∫•u c√¢u
    .replace(/[‚Äì-]/g, " ")         // D·∫•u g·∫°ch n·ªëi th√†nh kho·∫£ng tr·∫Øng ƒë·ªÉ m√°y ngh·ªâ nh·ªãp
    .replace(/\s+/g, " ")          // X√≥a kho·∫£ng tr·∫Øng th·ª´a
    .trim();
}

function handleSpeak(type) {
  synth.cancel();
  const rawText = (type === 'q') ? data[u].q[i][0] : data[u].q[i][1];
  const words = cleanForSpeech(rawText).split(" ");
  
  let wordIdx = 0;
  function speakWord() {
    if (wordIdx < words.length) {
      const utter = new SpeechSynthesisUtterance(words[wordIdx]);
      utter.lang = 'en-US';
      utter.rate = document.getElementById("speed").value;
      utter.pitch = 1.1; // Gi·ªçng cao h∆°n m·ªôt ch√∫t cho tr·∫ª em
      
      utter.onend = () => {
        wordIdx++;
        setTimeout(speakWord, 300); // Ngh·ªâ 0.3s gi·ªØa c√°c t·ª´
      };
      synth.speak(utter);
    }
  }
  speakWord();
}

// ==================
// LOGIC ·ª®NG D·ª§NG
// ==================
const unitSelect = document.getElementById("unitSelect");
data.forEach((unit, idx) => {
  unitSelect.innerHTML += `<option value="${idx}">${unit.name}</option>`;
});

unitSelect.onchange = (e) => { u = e.target.value; i = 0; render(); };
document.getElementById("speed").oninput = (e) => { 
  document.getElementById("speedVal").innerText = e.target.value; 
};

function render() {
  document.getElementById("qText").innerText = data[u].q[i][0];
  document.getElementById("aText").innerText = data[u].q[i][1];
  document.getElementById("aText").style.display = "none"; 
}

function toggle() {
  const a = document.getElementById("aText");
  a.style.display = (a.style.display === "block") ? "none" : "block";
}

function next() {
  if (i < data[u].q.length - 1) { i++; render(); }
}

function prev() {
  if (i > 0) { i--; render(); }
}

// Kh·ªüi ƒë·ªông
render();
</script>

</body>
</html>
